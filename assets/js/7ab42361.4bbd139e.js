"use strict";(self.webpackChunkbeethoven_docs=self.webpackChunkbeethoven_docs||[]).push([[2203],{8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(6540);const i={},o=s.createContext(i);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(o.Provider,{value:n},e.children)}},8600:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"type":"mdx","permalink":"/Beethoven-Docs/Beethoven/Platform/AWSF","source":"@site/src/pages/Beethoven/Platform/AWSF.md","title":"AWS F2 Implementation Flow","description":"Our AWS flow uses the HDK from the AWS FPGA Github: link.","frontMatter":{},"unlisted":false}');var i=t(4848),o=t(8453);const r={},a="AWS F2 Implementation Flow",l={},c=[{value:"Security Credentials",id:"security-credentials",level:2},{value:"AWS Instance Setup",id:"aws-instance-setup",level:2},{value:"Compiling",id:"compiling",level:2},{value:"Running",id:"running",level:2}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"aws-f2-implementation-flow",children:"AWS F2 Implementation Flow"})}),"\n",(0,i.jsxs)(n.p,{children:["Our AWS flow uses the HDK from the AWS FPGA Github: ",(0,i.jsx)(n.a,{href:"https://www.github.com/aws/aws-fpga",children:"link"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Note: The previous F1 flow provided a high-bandwidth DMA driver that used XDMA. The release of the F2 instances\ndid not include a DMA driver. While the AWS folks ",(0,i.jsx)(n.a,{href:"https://github.com/aws/aws-fpga/issues/671",children:"work on adding this functionality back"}),",\nwe provide a workaround that provides low-bandwidth data transfer, but should function for experimentation in the\ntime being."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Prior to implementing your accelerator on the F2 instance, do debug in simulation. After your design\nsimulates successfully, you'll have something that, if it passes timing, will work on the FPGA."}),"\n",(0,i.jsx)(n.h2,{id:"security-credentials",children:"Security Credentials"}),"\n",(0,i.jsxs)(n.p,{children:["Setup an AWS account and, if applicable, sign into your organization so that you don't personally get billed for all of this.\nIn your EC2 dashboard on the left sidebar, click ",(0,i.jsx)(n.strong,{children:"Key Pairs"}),". Under ",(0,i.jsx)(n.strong,{children:"Actions"})," at the top right, import a key pair from your\ncomputer. If you do not have an existing keypair, you can generate one using"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"# Generate a keypair and store it in ~/.ssh/id_ed25519[.pub]\nssh-keygen -t ed25519\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You should import the public key (e.g., ",(0,i.jsx)(n.code,{children:"~/.ssh/id_ed25519.puyb"}),"). Give the key an identifiable name."]}),"\n",(0,i.jsxs)(n.p,{children:["Next, we'll generate the AWS keys. At the top right of the EC2 Dashboard, click on your username and click ",(0,i.jsx)(n.strong,{children:"Security Credentials"}),".\nUnder access keys, generate an access key and save the CSV for these keys somewhere where you'll remember them."]}),"\n",(0,i.jsx)(n.h2,{id:"aws-instance-setup",children:"AWS Instance Setup"}),"\n",(0,i.jsxs)(n.p,{children:["In your EC2 dashboard, click ",(0,i.jsx)(n.strong,{children:"Launch Instances"}),'.\nYou\'ll be setting up a "compile" instance first. This will be the (cheaper) CPU instance for compiling your FPGA image and\ntransferring it over to the FPGA instance.']}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:['FPGAs are programmed using a "bitstream." This is similar to a normal executable in that it provides the program for the\nFPGA except instead of storing a sequence of instructions, it stores the layout of the circuit. This compilation process\nis long (many hours/days) and compute intensive. These circuit compilers are called EDA (Electronic Design Automation) tools\nand there is a large community that supports their development and ',(0,i.jsx)(n.a,{href:"https://www.dac.com",children:"research"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:['In the Amozon Machine Image (AMI) search box, look up "fpga". In the next window, click ',(0,i.jsx)(n.strong,{children:"AWS Marketplace AMIs"})," and select\nthe ",(0,i.jsx)(n.strong,{children:"FPGA Developer AMI"}),". I'm currently using version 1.16.1, but this may change in the future."]}),"\n",(0,i.jsxs)(n.p,{children:["When it takes you back to the previous page with the the AMI now selected, choose the instance type. We recommend something\nwith the best single-core performance and at least 32GB of RAM. We're currently using ",(0,i.jsx)(n.code,{children:"m5zn.2xlarge"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Finally, in the key-pair selection box, select the key-pair you previously uploaded, and launch the instance. The first\ntime starting an instance may take a while. As well, it may tell you lack the quota for the requested instance. Go through\nthe process of increasing your quote (may take a day or so)."}),"\n",(0,i.jsx)(n.p,{children:"Once you've launched an instance, it will start consuming your money, so shut it down if you're not actively using it."}),"\n",(0,i.jsx)(n.h2,{id:"compiling",children:"Compiling"}),"\n",(0,i.jsxs)(n.p,{children:["Once you have a functioning hardware design and are ready to deploy on the FPGA, start up your compile instance in the EC2 dashboard.\nTurn your hardware buildMode to ",(0,i.jsx)(n.code,{children:"Synthesis"})," and run using the ",(0,i.jsx)(n.code,{children:"AWSF2Platform"}),". When it completes running, it will ask for\nthe IP address for your compile instance. You can find this by clicking on your running instance in the EC2 dashboard (see under\nIPv4 address)."]}),"\n",(0,i.jsx)(n.p,{children:"Once entered, your design will transfer over to the instance. Log onto your instance and clone the AWS F2 repo. The following\nis some initial setup that you should only do once."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:'# change to home directory\ncd \n\n# Clone the aws repo\nsudo apt-get install -y git git-lfs python3\ngit clone https://github.com/aws/aws-fpga\n\n# Setup Beethoven\ngit clone https://github.com/Composer-Team/Beethoven\necho "export PATH=\\$HOME/Beethoven/bin:\\$PATH" >> ~/.bashrc\nsource ~/.bashrc\n\n# Add security credentials\n# Follow the prompts and use the entries from the CSV we generated earlier\n# Your region is likely us-east-1, but you should be able to see it on the\n# EC2 dashboard.\naws configure\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Next, you'll source the hdk setup. You should do this for ",(0,i.jsx)(n.strong,{children:"every terminal session"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"cd ~/aws-fpga\nsource hdk_setup.sh\n"})}),"\n",(0,i.jsx)(n.p,{children:"Finally, compile your FPGA image:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"cd ~/cl_beethoven_top/build/scripts/\npython3 aws_build_dcp_from_cl.py --cl cl_beethoven_top\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This should take a while, after which it'll either report success or failure.\nOn success, you should be able to run ",(0,i.jsx)(n.code,{children:"aws-build-mv"}),".\nTry to keep any associated keys simple: all lower-case, only symbols like ",(0,i.jsx)(n.code,{children:"-"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"You will be able to track the availability of your image with"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"aws ec2 describe-fpga-images --owner self\n"})}),"\n",(0,i.jsx)(n.p,{children:"After a while, the availablility will be marked 'available' and you'll be able to run the image from the F2 instance."}),"\n",(0,i.jsx)(n.h2,{id:"running",children:"Running"}),"\n",(0,i.jsxs)(n.p,{children:["Repeat the process of launching an instance except instead of an ",(0,i.jsx)(n.code,{children:"m5zn.2xlarge"}),", allocate an ",(0,i.jsx)(n.code,{children:"f2"})," type instance.\nWe'll select the smallest instance for our purposes."]}),"\n",(0,i.jsx)(n.p,{children:"Once you're in the instance, clone the aws repo and instead of sourcing the HDK setup, source the SDK setup."})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);