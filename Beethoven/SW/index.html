<!doctype html>
<html lang="en" dir="ltr" class="mdx-wrapper mdx-page plugin-pages plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Beethoven Software Stack | Beethoven</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://composer-team.github.io/Beethoven-Docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://composer-team.github.io/Beethoven-Docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://composer-team.github.io/Beethoven-Docs/Beethoven/SW/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Beethoven Software Stack | Beethoven"><meta data-rh="true" name="description" content="One of the goals of Beethoven is to provide a uniform deployment and testing process across platforms:"><meta data-rh="true" property="og:description" content="One of the goals of Beethoven is to provide a uniform deployment and testing process across platforms:"><link data-rh="true" rel="icon" href="/Beethoven-Docs/img/favicon.png"><link data-rh="true" rel="canonical" href="https://composer-team.github.io/Beethoven-Docs/Beethoven/SW/"><link data-rh="true" rel="alternate" href="https://composer-team.github.io/Beethoven-Docs/Beethoven/SW/" hreflang="en"><link data-rh="true" rel="alternate" href="https://composer-team.github.io/Beethoven-Docs/Beethoven/SW/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/Beethoven-Docs/blog/rss.xml" title="Beethoven RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Beethoven-Docs/blog/atom.xml" title="Beethoven Atom Feed"><link rel="stylesheet" href="/Beethoven-Docs/assets/css/styles.88a469ff.css">
<script src="/Beethoven-Docs/assets/js/runtime~main.82ee4b29.js" defer="defer"></script>
<script src="/Beethoven-Docs/assets/js/main.b73c5fc6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Beethoven-Docs/img/favicon.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Beethoven-Docs/"><div class="navbar__logo"><img src="/Beethoven-Docs/img/favicon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Beethoven-Docs/img/favicon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Beethoven</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Beethoven-Docs/Beethoven">Getting Started</a><a href="https://github.com/Composer-Team/Beethoven-Template" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Beethoven Project Template</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Composer-Team/Beethoven-Hardware" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><main class="container container--fluid margin-vert--lg"><div class="row mdxPageWrapper_j9I6"><div class="col col--8"><article><header><h1>Beethoven Software Stack</h1></header>
<p>One of the goals of Beethoven is to provide a uniform deployment and testing process across platforms:
Using an accelerator on a Zynq board should work the same as on AWS F2 and in our simulation platform.
<a href="https://github.com/ucb-bar/chiseltest/tree/main" target="_blank" rel="noopener noreferrer">ChiselTest</a> and Verilog testbenches are excellent
for unit-testing your modules, but are cumbersome for large-scale, end-to-end testing on real datasets.</p>
<p>Along with the Beethoven Hardware library, we&#x27;ve published a software integration stack that
supports simulation and device backends, allowing you to test the exact same software binary in
simulation before you deploy it. Our simulation backend supports multiple simulators: Verilator, and
simulators that support VPI (e.g., Icarus Verilog, VCS).</p>
<p align="center"></p><p><img decoding="async" loading="lazy" src="/Beethoven-Docs/assets/images/execution-stack-99263eb51e89d7c8b0a2870efa540ac7.jpg" width="569" height="477" class="img_ev3q"></p><p></p>
<p>The software stack comprises a userspace library and a device-management runtime.
The userspace library provides utilities for allocating accelerator-accessible memory regions and
routines for sending Beethoven-compliant command/response messages to the accelerator. The library
incorporates the hardware-generated C++ linkage into the programming environment, allowing the
user to communicate with their accelerator using the same control signals exposed inside their RTL.</p>
<p>We&#x27;ll start by looking at a simple example that continues from the hardware design we developed in the
Beethoven Hardware stack section (<a href="/Beethoven-Docs/Beethoven/HW">link</a>).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-basic-example-contd">A Basic Example (cont&#x27;d)<a href="#a-basic-example-contd" class="hash-link" aria-label="Direct link to A Basic Example (cont&#x27;d)" title="Direct link to A Basic Example (cont&#x27;d)">​</a></h2>
<p>Picking up from where we left off with our vector addition core, we had just built our hardware. With
your environment properly set up (having set your <code>BEETHOVEN_PATH</code> environment variable in your bashrc),
it should have generated your hardware modules in <code>$BEETHOVEN_PATH/build/hw</code> and your C++ linkages
in <code>$BEETHOVEN_PATH/build/beethoven_hardware.h</code> and <code>$BEETHOVEN_PATH/build/beethoven_hardware.cc</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testbench">Testbench<a href="#testbench" class="hash-link" aria-label="Direct link to Testbench" title="Direct link to Testbench">​</a></h3>
<p>The header should have a stub that looks like this:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">namespace</span><span class="token plain"> myVectorAdd </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        beethoven</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">response_handle</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token keyword" style="font-style:italic">bool</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">vector_add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">uint16_t</span><span class="token plain"> core_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            beethoven</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">remote_ptr vec_a_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            beethoven</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">remote_ptr vec_b_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            beethoven</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">remote_ptr vec_out_addr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">uint32_t</span><span class="token plain"> vector_length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To use our core, let&#x27;s set up a new CMake project. Your <code>CMakeLists.txt</code> will go in the root directory
of your c++ directory and will look something like this.</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake_minimum_required(VERSION 3.30)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">project(vector_add)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">find_package(beethoven REQUIRED)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set(CMAKE_CXX_STANDARD 17)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">beethoven_build(vector_add</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    SOURCES main.cpp)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you&#x27;ve installed the Beethoven software library correctly, <code>find_package</code> should work correctly.
<code>beethoven_build</code> is a function that declares a new target in a similar way to <code>add_executable</code>.
We&#x27;ll create a new c++ source file called <code>main.cpp</code> and insert the boilerplate:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;iostream&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;beethoven/fpga_handle.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;beethoven_hardware.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">namespace</span><span class="token plain"> beethoven</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  fpga_handle_t handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>fpga_handle_t</code> is our way of communicating with our accelerator. Once it&#x27;s been constructed
somewhere in your executable, you&#x27;ll be able to call on your accelerator. First, let&#x27;s look at the
arguments to our vector-add unit.</p>
<p>First, there&#x27;s <code>core_id</code>. If we elaborated a multi-core accelerator, we can use this argument to
specify which core we want to execute our vector-add. Next, we have a few <code>beethoven::remote_ptr</code>
arguments for our vectors. When you use an <code>Address</code> type in a <code>BeethovenIO</code>, it will result in the
use of <code>beethoven::remote_ptr</code> in the c++ linkage.</p>
<p><code>remote_ptr</code> is a smart pointer that we use for making allocations that are accessible from our
accelerator. It has <code>shared_ptr</code> <a href="https://en.cppreference.com/w/cpp/memory/shared_ptr" target="_blank" rel="noopener noreferrer">semantics</a>,
so you should not need to free it manually.The use of this
special type is necessary because some accelerators share the same address space with the host
CPU (ex. Zynq) whereas others have discrete address spaces (ex. AWS F2). We hide the implementation
details for managing these address spaces inside the pointer type.</p>
<p>To allocate a slice of memory that is accessible from your accelerator, the <code>fpga_handle_t</code> exposes
a <code>malloc</code> interface that behaves like a typical C <code>malloc</code> interfaces. The <code>remote_ptr</code> allocates
a slice of memory in the host address space. You can fetch this pointer using <code>.getHostAddr()</code>,
initialize the memory and use it like a normal memory allocation.
To transfer the allocation over to the accelerator-accessible space, we use
<code>handle.copy_to_fpga()</code>.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fpga_handle_t handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> size_of_int </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> n_eles </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> vec_a </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">malloc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size_of_int </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> n_eles</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> vec_b </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">malloc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size_of_int </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> n_eles</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> vec_out </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">malloc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size_of_int </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> n_eles</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> vec_a_host </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">vec_a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getHostAddr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> vec_b_host </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">vec_b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getHostAddr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> n_eles</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vec_a_host</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    vec_b_host</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">copy_to_fpga</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vec_a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">copy_to_fpga</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vec_b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, to call our accelerator we use the stub:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> resp_handle </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> myVectorAdd</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">vector_add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                           vec_a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                           vec_b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                           vec_out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                           n_eles</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This returns a response handle. Although your accelerator is now executing, your host CPU can
continue working until you&#x27;re ready to block and wait for your code to finish. Then, you
can copy your results back to host-accessible memory using <code>handle.copy_from_fpga(...)</code>.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> response </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> resp_handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">copy_from_fpga</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">vec_out</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you want to check if your code has finished, but not block if it hasn&#x27;t, then we also offer a <code>try_get()</code>.
The <code>response</code> payload will be the struct specified by your accelerator core <code>BeethovenIO</code> if you
specified one. If you specified no response acknowledgement, <code>.get()</code> will throw an error.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-your-code">Run your code<a href="#run-your-code" class="hash-link" aria-label="Direct link to Run your code" title="Direct link to Run your code">​</a></h3>
<p>Now we have our testbench. To simulate our code, we&#x27;ll start up the Beethoven Runtime.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Simulation (Icarus Verilog)</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Simulation (VCS)</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Simulation (Verilator)</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">AWS F2</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Zynq</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Composer-Team/Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bash setup_dramsim.sh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># this will build and run the simulator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make sim_icarus</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Composer-Team/Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bash setup_dramsim.sh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake .. -DCMAKE_BUILD_TYPE=Release -DTARGET=sim -DSIMULATOR=vcs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make -j</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">../scripts/build_vcs.sh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># run the runtime/simulator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./BeethovenTop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Composer-Team/Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bash setup_dramsim.sh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake .. -DCMAKE_BUILD_TYPE=Release -DTARGET=sim -DSIMULATOR=verilator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make -j</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># run the runtime/simulator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./BeethovenRuntime</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Composer-Team/Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake .. -DCMAKE_BUILD_TYPE=Release -DTARGET=fpga -DBACKEND=F2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make -j</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># run the runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo ./BeethovenRuntime</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Composer-Team/Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake .. -DCMAKE_BUILD_TYPE=Release -DTARGET=fpga -DBACKEND=Kria</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make -j</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># run the runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo ./BeethovenRuntime</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<p>Each one of these simulation platforms should provide the same results. We recommend
using either VCS or Icarus Verilog for simulation because they support tri-state logic (X, Z).
We&#x27;ve also found instances where the Verilator compile time becomes prohibitively long (hours)
whereas simulation + running for the others is a matter of a few minutes.</p>
<p>Once your simulator is running, compile and run your testbench binary like so.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># inside your c testbench directory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake ..</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make -j</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./vector_add</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will execute your accelerator core! Now you can quit the runtime and view the
waveform for your execution.</p>
<p>In Verilator, CTRL+C is sufficient. For VCS and Icarus, CTRL+C to exit to the simulation
shell and run <code>finish</code>. This will ensure the waveform is properly flushed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="beethoven-library">Beethoven Library<a href="#beethoven-library" class="hash-link" aria-label="Direct link to Beethoven Library" title="Direct link to Beethoven Library">​</a></h2>
<p>The library implements the integration between the user&#x27;s testbench process and the simulator / FPGA management process.
There are two basic interfaces available to the programmer:</p>
<ol>
<li>Sending commands/receiving responses</li>
<li>Allocating Memory</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="communicating-with-the-accelerator">Communicating with the Accelerator<a href="#communicating-with-the-accelerator" class="hash-link" aria-label="Direct link to Communicating with the Accelerator" title="Direct link to Communicating with the Accelerator">​</a></h3>
<p>We strongly recommend that any communication you have with your accelerator be over the generated C++ stubs from having
generated your hardware. If you&#x27;ve properly set up your environment, you should find them in <code>$BEETHOVEN_PATH/build/beethoven_hardware.h</code>.
Whenever you call your function stub with the parameters specified by the <code>BeethovenIO</code> interface from your hardware, it will
return a <code>beethoven::response_handle&lt;type_t&gt;</code>.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">template</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token keyword" style="font-style:italic">typename</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">t</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">response_handle</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    t </span><span class="token function" style="color:rgb(130, 170, 255)">get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token plain">optional</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">t</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">try_get</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The response handle can be used to allow asynchronous execution of the host with the accelerator device. Calling
<code>.get()</code> blocks the host process while waiting for the accelerator response. <code>.try_get()</code> will query for a response
from the accelerator and will return a None-type if the response is not ready yet.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="allocating-memory">Allocating Memory<a href="#allocating-memory" class="hash-link" aria-label="Direct link to Allocating Memory" title="Direct link to Allocating Memory">​</a></h3>
<p>Beethoven exposes a typical <code>malloc</code> interface to the user. It should work identically on embedded platforms, discrete platforms,
and in simulation - the user should not need to change their usage of malloc based on the platform. The malloc interface is a
member of <code>fpga_handle_t</code>, which facilitates communication with the accelerator, and should be used like so.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">namespace</span><span class="token plain"> beethoven</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fpga_handle_t handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> alloc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">malloc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>.malloc()</code> will not only allocate space in the accelerator address space, but will allocate an associated space in the host
address space. The addresses to these spaces are accessible from the return type from malloc: <code>remote_ptr</code>.</p>
<p><code>remote_ptr</code> is a smart pointer type that will free itself when no valid references to the allocation exist (equivalent to std::shared_ptr).
The host address is accessible via <code>.getHostAddr()</code> and the FPGA address is accessible via <code>.getFpgaAddr()</code>. Example:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">namespace</span><span class="token plain"> beethoven</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fpga_handle_t handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">auto</span><span class="token plain"> alloc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> handle</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">malloc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">64</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> host_allocation </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> alloc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getHostAddr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">uint64_t</span><span class="token plain"> fpga_allocation </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> alloc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getFpgaAddr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In practice there is no reason to use <code>.getFpgaAddr()</code> because when you use the <code>Address</code> type inside the declaration of your hardware&#x27;s
<code>BeethovenIO</code> interfaces, it will produce a C++ stub that directly takes in your <code>remote_ptr</code> object and extracts the FPGA address for you.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dma-transfers">DMA Transfers<a href="#dma-transfers" class="hash-link" aria-label="Direct link to DMA Transfers" title="Direct link to DMA Transfers">​</a></h3>
<p>To move data between host and accelerator address spaces, use the <code>handle.copy_to_fpga</code> and <code>handle.copy_from_fpga</code> routines.</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">copy_to_fpga</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> remote_ptr </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">dst</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">copy_from_fpga</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> remote_ptr </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">src</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These routines deduce from the generated hardware header how to instrument memory DMA between the host and accelerator. These routines are
only <em>really</em> necessary on platforms with discrete accelerator/host memory spaces, but we think it&#x27;s a good idea to instrument your code
with these routines even if you don&#x27;t need them to improve code portability across platforms.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="beethoven-runtime">Beethoven Runtime<a href="#beethoven-runtime" class="hash-link" aria-label="Direct link to Beethoven Runtime" title="Direct link to Beethoven Runtime">​</a></h2>
<p>When using the runtime over a real FPGA, the runtime manages all communication between host
processes and the device. It is responsible for moving over commands as well as polling the
FPGA for responses. The rate of this polling is configurable in the source file
<code>src/response_poller.cc</code> <a href="https://github.com/Composer-Team/Beethoven-Runtime/blob/master/src/response_poller.cc" target="_blank" rel="noopener noreferrer">[link]</a>
if you wish to increase or decrease the rate. By default, it is set to 10µs.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="building">Building<a href="#building" class="hash-link" aria-label="Direct link to Building" title="Direct link to Building">​</a></h3>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Simulation (Icarus Verilog)</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Simulation (VCS)</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Simulation (Verilator)</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">AWS F2</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Zynq</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Composer-Team/Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bash setup_dramsim.sh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># this will build and run the simulator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make sim_icarus</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Composer-Team/Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bash setup_dramsim.sh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake .. -DCMAKE_BUILD_TYPE=Release -DTARGET=sim -DSIMULATOR=vcs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make -j</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">../scripts/build_vcs.sh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># run the runtime/simulator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./BeethovenTop</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Composer-Team/Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bash setup_dramsim.sh</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake .. -DCMAKE_BUILD_TYPE=Release -DTARGET=sim -DSIMULATOR=verilator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make -j</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># run the runtime/simulator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./BeethovenRuntime</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Composer-Team/Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake .. -DCMAKE_BUILD_TYPE=Release -DTARGET=fpga -DBACKEND=F2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make -j</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># run the runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo ./BeethovenRuntime</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Composer-Team/Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake .. -DCMAKE_BUILD_TYPE=Release -DTARGET=fpga -DBACKEND=Kria</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make -j</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># run the runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo ./BeethovenRuntime</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="memory-modeling">Memory Modeling<a href="#memory-modeling" class="hash-link" aria-label="Direct link to Memory Modeling" title="Direct link to Memory Modeling">​</a></h3>
<p>Beethoven hardware emits memory transactions using the AXI4 protocol. To accurately model DRAM latencies in our simulator
we implement a AXI4-DDR controller that models DDR using <a href="https://github.com/umd-memsys/DRAMsim3/tree/master" target="_blank" rel="noopener noreferrer">DRAMSim3</a>.
DRAMSim3 allows us to model different memory technologies by simply changing the memory configuration input file.
By default we use the <code>DDR4_8Gb_x16_3200.ini</code> config that comes with DRAMSim, but you can change the configuration
by defining the <code>DRAMSIM_CONFIG</code> build variable for VPI-based builds or by starting the Verilator-based simulator
using <code>./BeethovenTop -dramconfig &lt;your_config&gt;</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="allocator-implementation">Allocator Implementation<a href="#allocator-implementation" class="hash-link" aria-label="Direct link to Allocator Implementation" title="Direct link to Allocator Implementation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="discrete-device-allocator">Discrete Device Allocator<a href="#discrete-device-allocator" class="hash-link" aria-label="Direct link to Discrete Device Allocator" title="Direct link to Discrete Device Allocator">​</a></h3>
<p>When operating on a discrete device, Beethoven provides a thread-safe allocator implementation
so that separate threads and processes can fully utilize the FPGA&#x27;s memory space without
relying on inter-process communication to synchronize allocations.</p>
<p>The allocator maintains allocation state entirely in the runtime process and stores nothing inside
the FPGA memory. It is a slab-based allocator with 2MB slabs and a minimum allocation size of 4KB.
Allocations of less than 4KB will not fault, but will incur external fragmentation.</p>
<p><a href="https://github.com/Composer-Team/Beethoven-Software/blob/master/include/beethoven/allocator/device_allocator.h" target="_blank" rel="noopener noreferrer">[Implementation]</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="embedded-device-allocator">Embedded Device Allocator<a href="#embedded-device-allocator" class="hash-link" aria-label="Direct link to Embedded Device Allocator" title="Direct link to Embedded Device Allocator">​</a></h3>
<p>When the accelerator device shares the address space with the host CPU, the operating system needs
to know about the allocations that we make. Currently, we don&#x27;t support virtual addressing on the
Zynq platforms, so we use Linux <a href="https://www.kernel.org/doc/html/latest/admin-guide/mm/hugetlbpage.html" target="_blank" rel="noopener noreferrer">[hugepages]</a>
to make physical memory allocations that are larger than 4KB. When running on a Zynq system,
Beethoven&#x27;s <code>malloc</code> uses <code>mmap</code> to allocate the memory and then obtains the virtual to physical
mapping from the OS.</p>
<p>We provide a script <a href="https://github.com/Composer-Team/Beethoven/blob/main/bin/kria/kria_mm.py" target="_blank" rel="noopener noreferrer">here</a> for
pre-allocating hugepages on Zynq platforms.</p></article></div><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#a-basic-example-contd" class="table-of-contents__link toc-highlight">A Basic Example (cont&#39;d)</a><ul><li><a href="#testbench" class="table-of-contents__link toc-highlight">Testbench</a></li><li><a href="#run-your-code" class="table-of-contents__link toc-highlight">Run your code</a></li></ul></li><li><a href="#beethoven-library" class="table-of-contents__link toc-highlight">Beethoven Library</a><ul><li><a href="#communicating-with-the-accelerator" class="table-of-contents__link toc-highlight">Communicating with the Accelerator</a></li><li><a href="#allocating-memory" class="table-of-contents__link toc-highlight">Allocating Memory</a></li><li><a href="#dma-transfers" class="table-of-contents__link toc-highlight">DMA Transfers</a></li></ul></li><li><a href="#beethoven-runtime" class="table-of-contents__link toc-highlight">Beethoven Runtime</a><ul><li><a href="#building" class="table-of-contents__link toc-highlight">Building</a></li><li><a href="#memory-modeling" class="table-of-contents__link toc-highlight">Memory Modeling</a></li></ul></li><li><a href="#allocator-implementation" class="table-of-contents__link toc-highlight">Allocator Implementation</a><ul><li><a href="#discrete-device-allocator" class="table-of-contents__link toc-highlight">Discrete Device Allocator</a></li><li><a href="#embedded-device-allocator" class="table-of-contents__link toc-highlight">Embedded Device Allocator</a></li></ul></li></ul></div></div></div></main></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Beethoven-Docs/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Beethoven-Docs/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>