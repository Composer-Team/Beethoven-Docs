<!doctype html>
<html lang="en" dir="ltr" class="mdx-wrapper mdx-page plugin-pages plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">AMD Kria (Zynq) Implementation flow | Beethoven</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://composer-team.github.io/Beethoven-Docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://composer-team.github.io/Beethoven-Docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://composer-team.github.io/Beethoven-Docs/Beethoven/Platform/Kria"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="AMD Kria (Zynq) Implementation flow | Beethoven"><meta data-rh="true" name="description" content="Setup"><meta data-rh="true" property="og:description" content="Setup"><link data-rh="true" rel="icon" href="/Beethoven-Docs/img/favicon.png"><link data-rh="true" rel="canonical" href="https://composer-team.github.io/Beethoven-Docs/Beethoven/Platform/Kria"><link data-rh="true" rel="alternate" href="https://composer-team.github.io/Beethoven-Docs/Beethoven/Platform/Kria" hreflang="en"><link data-rh="true" rel="alternate" href="https://composer-team.github.io/Beethoven-Docs/Beethoven/Platform/Kria" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/Beethoven-Docs/blog/rss.xml" title="Beethoven RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Beethoven-Docs/blog/atom.xml" title="Beethoven Atom Feed"><link rel="stylesheet" href="/Beethoven-Docs/assets/css/styles.88a469ff.css">
<script src="/Beethoven-Docs/assets/js/runtime~main.6f4423ee.js" defer="defer"></script>
<script src="/Beethoven-Docs/assets/js/main.b73c5fc6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/Beethoven-Docs/img/favicon.png"><link rel="preload" as="image" href="/Beethoven-Docs/img/kria/1_initial.png"><link rel="preload" as="image" href="/Beethoven-Docs/img/kria/2_hw_manager.png"><link rel="preload" as="image" href="/Beethoven-Docs/img/kria/3_server.png"><link rel="preload" as="image" href="/Beethoven-Docs/img/kria/4_program.png"><link rel="preload" as="image" href="/Beethoven-Docs/img/kria/5_flash.png"><link rel="preload" as="image" href="/Beethoven-Docs/img/kria/6_progress.png"><link rel="preload" as="image" href="/Beethoven-Docs/img/kria/7_setup.jpg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Beethoven-Docs/"><div class="navbar__logo"><img src="/Beethoven-Docs/img/favicon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Beethoven-Docs/img/favicon.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Beethoven</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Beethoven-Docs/Beethoven">Getting Started</a><a href="https://github.com/Composer-Team/Beethoven-Template" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Beethoven Project Template</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Composer-Team/Beethoven-Hardware" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><main class="container container--fluid margin-vert--lg"><div class="row mdxPageWrapper_j9I6"><div class="col col--8"><article><header><h1>AMD Kria (Zynq) Implementation flow</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">​</a></h2>
<p>Our development setup does not need to change from your main computing environment.
If you&#x27;re developing on Beethoven on Mac/Windows, that&#x27;s fine and you won&#x27;t need to install Vivado to run your design.
In practice, we have a remote EDA machine that&#x27;s connected to our Kria board.
If you have a Kria board/EDA tools installed somewhere then you can modify this procedure to your liking, but this is
how we have it working.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="eda-machine">EDA Machine<a href="#eda-machine" class="hash-link" aria-label="Direct link to EDA Machine" title="Direct link to EDA Machine">​</a></h3>
<ul>
<li>RHEL 8</li>
<li>Vivado 2024.2</li>
<li>Vivado cable drivers installed for flashing FPGA over JTAG <a href="https://digilent.com/reference/programmable-logic/guides/install-cable-drivers" target="_blank" rel="noopener noreferrer">[link]</a>. Only do the first command, adding users is unnecessary.</li>
<li>Java 17 or older</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="kria">Kria<a href="#kria" class="hash-link" aria-label="Direct link to Kria" title="Direct link to Kria">​</a></h3>
<ul>
<li>Petalinux</li>
<li>CMake from source</li>
<li>C++17 compliant compiler</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="building-and-flashing-fpga-image">Building and Flashing FPGA Image<a href="#building-and-flashing-fpga-image" class="hash-link" aria-label="Direct link to Building and Flashing FPGA Image" title="Direct link to Building and Flashing FPGA Image">​</a></h2>
<p>When you&#x27;ve tested your design and are ready to deploy, we&#x27;ll have to build the accelerator in Synthesis mode.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">object </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyAcceleratorKria</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">extends</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">BeethovenBuild</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">MyAcceleratorConfig</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  buildMode </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">BuildMode</span><span class="token class-name punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token class-name" style="color:rgb(255, 203, 107)">Synthesis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  platform </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">KriaPlatform</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you&#x27;re building in an IDE that supports remote development, you can use this opportunity to run this function
on your EDA machine. The IDE <em>should</em> handle moving over all of the necessary files for running things remotely.
Otherwise, you can commit your code, clone it on your EDA machine and run the main file that way. Both ways work
perfectly.</p>
<p>Now, when you <code>cd $BEETHOVEN_PATH/build/</code> on your EDA machine, you&#x27;ll notice the following files.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">(base) [chriskjellqvist@oak build]$ ls</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">beethoven              beethoven_hardware.h  hw      synth.tcl             vcs_srcs.in</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">beethoven_hardware.cc  cmake_srcs.cmake      ip.tcl  user_constraints.xdc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In particular, these <code>.tcl</code> files are the scripts we generate for building your Kria accelerator.</p>
<ul>
<li><code>synth.tcl</code> - the main .tcl that you should run</li>
<li><code>ip.tcl</code> - generate any Xilinx IPs that you need or declared in your program</li>
</ul>
<p>You can build your accelerator like so...</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># enter the vivado shell</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">vivado -mode tcl</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># start synthesizing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">source synth.tcl</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># once we&#x27;re done, we&#x27;ll use the GUI to deploy our design</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">start_gui</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now the following GUI should come up.</p>
<p align="center"><img src="/Beethoven-Docs/img/kria/1_initial.png"></p>
<p>If you pass timing and all that good stuff (you can check under the &quot;Open Implemented Design&quot; tab on the left panel),
then generate bitstream (also on the left panel). Once you&#x27;re done there, open up the hardware design like so:</p>
<p align="center"><img src="/Beethoven-Docs/img/kria/2_hw_manager.png"></p>
<p>Start up the hardware server next. If you&#x27;ve installed the cable drivers correctly, it should all <em>just work</em>.</p>
<p align="center"><img src="/Beethoven-Docs/img/kria/3_server.png"></p>
<p>Next, right click the FPGA on Kria and program it using your bitstream:</p>
<p align="center"><img src="/Beethoven-Docs/img/kria/4_program.png"><img src="/Beethoven-Docs/img/kria/5_flash.png"><img src="/Beethoven-Docs/img/kria/6_progress.png"></p>
<p>Now you may hear the fan spin up on your Kria board because the FPGA is active. We&#x27;ve had trouble with the fan
control in petalinux so we have a fan with an external manual control to keep the office quiet.</p>
<p align="center"><img src="/Beethoven-Docs/img/kria/7_setup.jpg"></p><p>Our Office Setup. EDA box to the left, Kria, network switch and fan center. The white cable connects the micro-USB Kria
connector to our EDA box for JTAG.</p><p></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-on-kria">Running on Kria<a href="#running-on-kria" class="hash-link" aria-label="Direct link to Running on Kria" title="Direct link to Running on Kria">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="environment-setup">Environment Setup<a href="#environment-setup" class="hash-link" aria-label="Direct link to Environment Setup" title="Direct link to Environment Setup">​</a></h3>
<p>First thing&#x27;s first, make sure your environment is set up correctly. In our <code>~/.bashrc</code> on kria, it&#x27;s important that
we first install the correct C/C++ compilers:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">dnf install g++ gcc python3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This should install something like version 12.2 or similar. These have support for C++17 so they will be sufficient.
Next, install <a href="https://cmake.org" target="_blank" rel="noopener noreferrer">Cmake</a> from source. Unfortunately, this seems to be necessary because the Kria repos
do not have a package for this.</p>
<p>Now, get your <code>~/.bashrc</code> in shape. These are the most important lines to have. This assumes that your user is <code>petalinux</code>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">export CXX=aarch64-xilinx-linux-g++</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">export CC=aarch64-xilinx-linux-gcc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">export BEETHOVEN_PATH=/home/petalinux/Beethoven</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Go ahead and <code>mkdir ~/Beethoven</code>. Now, get the Beethoven environment.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Composer-Team/Beethoven-Software</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Composer-Team/Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">git clone https://github.com/Composer-Team/Beethoven</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd Beethoven-Software</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake .. -DCMAKE_BUILD_TYPE=Release -DPLATFORM=kria</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make -j4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo make install</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd ../../</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cp Beethoven/bin/kria/kria_mm.py ~/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You should now have the software installed correctly and a file called <code>kria_mm.py</code> in your home directory. Because the
Kria system shares the same DRAM space between FPGA and CPU, the operating system needs to know about any allocations
that you use in the FPGA, in contrast to the discrete FPGA boards. We use Linux Hugepages make large, physicaly contiguous
allocations that are accessible from the FPGA and cache coherent with the CPU. However, these pages need to be
preallocated so we provide this script.</p>
<p>Whenever you run the <code>kria_mm.py</code> script (sudo required), you should get the following.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">xilinx-kv260-starterkit-20241:~$ sudo python3 kria_mm.py</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Password:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Hugepage allocations----------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[idx]	[name]             	[n_alloc]	[n_free]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[0]	    hugepages-2048kB   	0		    0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[1]	    hugepages-32768kB  	0		    0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2]	    hugepages-64kB     	0		    0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[3]	    hugepages-1048576kB	0		    0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Which hugepage allocation to modify (enter to quit)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To allocate 64 of 2048kB blocks, we would type <code>0</code>, <code>&lt;enter&gt;</code>, and then the number of blocks, <code>64</code>.
The script will wait a second and make sure the effects have persisted. Allocating extremely large blocks (e.g., 1GB) may
fail if the system does not have any allocations of that size available.</p>
<p>After the above commmand, the final printout should look something like this.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">xilinx-kv260-starterkit-20241:~$ python3 kria_mm.py</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">This script must be run as root</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">xilinx-kv260-starterkit-20241:~$ sudo python3 kria_mm.py</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Password:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Hugepage allocations----------------------</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[idx]	[name]             	[n_alloc]	[n_free]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[0]	hugepages-2048kB   	0		0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[1]	hugepages-32768kB  	0		0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[2]	hugepages-64kB     	0		0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[3]	hugepages-1048576kB	0		0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Which hugepage allocation to modify (enter to quit)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Current allocation of [hugepages-2048kB]: 0/0 available</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">How many hugepages to set the max allocation to?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; 64</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Set allocation of [hugepages-2048kB] to 64. Waiting a second to recheck...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Rechecking...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Successfully set allocation of [hugepages-2048kB] to 64</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">xilinx-kv260-starterkit-20241:~$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Allocations that use standard page sizes (4kB) will still use standard pages, but for anything larger, we&#x27;ll use the smallest
page size available. Unfortunately, this means you should have a good idea of how many pages you&#x27;ll need before hand. The allocator
will throw and if it fails to allocate, so these situations should make themselves immediately visible.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="moving-over-headers">Moving Over Headers<a href="#moving-over-headers" class="hash-link" aria-label="Direct link to Moving Over Headers" title="Direct link to Moving Over Headers">​</a></h3>
<p>It would be a pain to build your hardware and generate the headers on Kria so we use <code>rsync</code> to move over all the necessary headers
from the EDA/development machine.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rsync -rzah $BEETHOVEN_PATH/ petalinux@&lt;KRIA_IP&gt;:~/Beethoven/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="build-runtime-and-go">Build Runtime and Go!<a href="#build-runtime-and-go" class="hash-link" aria-label="Direct link to Build Runtime and Go!" title="Direct link to Build Runtime and Go!">​</a></h3>
<p>Then, on Kria, we can build the runtime.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd ~/Beethoven-Runtime</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mkdir build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cd build</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cmake .. \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -DCMAKE_BUILD_TYPE=Release \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -TARGET=fpga \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -DBACKEND=Kria</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">make -j4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sudo ./BeethovenRuntime</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In a different TTY, we can run our testbench. The testbench will use the same build procedure as with simulator or any other backend.
Then, just run with <code>sudo</code> and voila!</p></article></div><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a><ul><li><a href="#eda-machine" class="table-of-contents__link toc-highlight">EDA Machine</a></li><li><a href="#kria" class="table-of-contents__link toc-highlight">Kria</a></li></ul></li><li><a href="#building-and-flashing-fpga-image" class="table-of-contents__link toc-highlight">Building and Flashing FPGA Image</a></li><li><a href="#running-on-kria" class="table-of-contents__link toc-highlight">Running on Kria</a><ul><li><a href="#environment-setup" class="table-of-contents__link toc-highlight">Environment Setup</a></li><li><a href="#moving-over-headers" class="table-of-contents__link toc-highlight">Moving Over Headers</a></li><li><a href="#build-runtime-and-go" class="table-of-contents__link toc-highlight">Build Runtime and Go!</a></li></ul></li></ul></div></div></div></main></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Beethoven-Docs/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/Beethoven-Docs/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>